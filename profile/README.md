# FluxBalancer

## TL;DR

**FluxBalancer** – исследовательский прототип адаптивного HTTP-балансировщика нагрузки для распределённых систем на базе Docker.

Проект реализует **онлайн-балансировку и управляемую репликацию запросов** на основе **многокритериального принятия решений (MCDM)** с динамическим вычислением весов критериев по энтропии Шеннона.

* учитывает CPU / RAM / NET / latency
* поддерживает TOPSIS, AIRM, ELECTRE, SAW
* снижает хвостовые задержки (p95/p99)
* контролирует work amplification при репликации
* реализован как асинхронный HTTP-прокси

---

**FluxBalancer** – исследовательский программный прототип адаптивного HTTP-балансировщика нагрузки с поддержкой управляемой репликации запросов в распределённых системах на базе контейнерной инфраструктуры Docker.

Проект разработан в рамках выпускной квалификационной работы бакалавра по направлению
**01.03.04 — Прикладная математика**
НИТУ «МИСИС», Кафедра инженерной кибернетики.

---

## Статус проекта

**Research prototype / Bachelor thesis project**
Проект предназначен для научных исследований и экспериментального анализа.
Не является промышленным продуктом, но может служить основой для дальнейшего развития и внедрения.

---

## Аннотация

Объектом исследования является процесс балансировки трафика и управления репликацией запросов в распределённых системах, функционирующих в условиях высокой динамики нагрузки и ограничений по SLA.

Целью работы является разработка и экспериментальное исследование адаптивного балансировщика нагрузки, использующего методы многокритериального принятия решений (MCDM) и поддерживающего управляемую репликацию запросов с целью снижения хвостовых задержек при контролируемом росте избыточной вычислительной нагрузки (work amplification).

В проекте реализован потоковый HTTP-прокси, осуществляющий маршрутизацию запросов к Docker-контейнерам на основе их текущего состояния. Для принятия решений используются динамически собираемые метрики загрузки CPU, оперативной памяти, сетевого трафика и фактической задержки обработки запросов.

Весовые коэффициенты критериев вычисляются автоматически с применением энтропийного подхода Шеннона, что позволяет адаптировать стратегию балансировки к изменяющимся условиям без ручной настройки параметров. Для ранжирования узлов реализован набор многокритериальных алгоритмов, включая TOPSIS, AIRM, ELECTRE и SAW.

В рамках работы проведены вычислительные эксперименты, показавшие, что методы TOPSIS и AIRM обеспечивают наилучший компромисс между снижением хвостовых задержек и равномерностью распределения нагрузки, а адаптивные политики репликации позволяют существенно снизить p95/p99 задержки при умеренном росте work amplification.

---

## Решаемая задача

FluxBalancer рассматривает задачу балансировки нагрузки как задачу многокритериального выбора оптимального узла маршрутизации в онлайн-режиме.

Каждый узел характеризуется вектором динамических показателей состояния:

* загрузка CPU,
* использование оперативной памяти,
* интенсивность сетевого ввода/вывода,
* фактическая задержка обработки HTTP-запросов.

Все критерии относятся к типу **затратных** (меньше – лучше).
Задача выбора формулируется как минимизация агрегированной функции потерь при наличии SLA-ограничений и возможной репликации запросов.

---

## Реализованные алгоритмы балансировки

В проекте реализованы и сравнены следующие методы MCDM:

* **SAW (Simple Additive Weighting)** – линейная скаляризация;
* **TOPSIS** – метод идеальной и анти-идеальной точки;
* **ELECTRE (упрощённый ELECTRE III)** – метод превосходства по рангу;
* **AIRM** – стохастический метод с моделированием весов распределением Дирихле и оценкой вероятности доминирования альтернатив.

Алгоритмы применяются в онлайн-режиме и работают с динамически обновляемыми метриками узлов.

---

## Репликация запросов

FluxBalancer поддерживает управление репликацией запросов как механизм снижения хвостовых задержек:

* фиксированная параллельная репликация;
* отложенная репликация (*hedged requests*);
* задел под спекулятивное выполнение.

Репликация рассматривается как компромисс между снижением задержек и ростом избыточной нагрузки, формализуемой через коэффициент **work amplification (WA)**.
Эффективность репликации анализируется совместно с качеством ранжирования узлов.

---

## Архитектура системы

Система построена по модульному принципу и включает:

* асинхронный HTTP-прокси (FastAPI);
* middleware маршрутизации и проксирования запросов;
* подсистему онлайн-сбора метрик Docker-контейнеров;
* механизм сглаживания и агрегации метрик (EMA);
* модуль многокритериального принятия решений;
* расширяемый реестр алгоритмов балансировки.

Архитектура реализует замкнутый цикл:

> сбор метрик → вычисление весов → ранжирование → маршрутизация → обратная связь.

---

## Научная новизна / Scientific contribution

Научная новизна работы заключается в следующем:

* предложена формализация задачи балансировки нагрузки и репликации запросов в терминах многокритериального принятия решений для онлайн-сценариев;
* реализовано динамическое вычисление весов критериев на основе энтропии Шеннона без ручной калибровки;
* проведено экспериментальное сравнение детерминированных и стохастических MCDM-алгоритмов в потоковом прокси;
* показано, что качество многокритериального ранжирования напрямую влияет на эффективность репликации и уровень work amplification;
* экспериментально подтверждён выигрыш методов TOPSIS и AIRM в снижении хвостовых задержек при высокой вариативности нагрузки;
* продемонстрирована практическая применимость MCDM-подходов в реальных Docker-кластерах с минимальными накладными задержками.

---

## Практическая значимость

Результаты работы могут быть использованы при проектировании:

* высоконагруженных микросервисных систем;
* прокси-балансировщиков и API-шлюзов;
* облачных и контейнерных платформ с жёсткими SLA-ограничениями.

---

## Перспективы развития

* интеграция предиктивных моделей и методов машинного обучения;
* проактивное управление репликацией;
* адаптивная настройка SLA-параметров;
* расширение модели критериев и поддержка heterogeneous-кластеров.

---

## Инженерные и архитектурные решения

### Архитектурный подход

Проект реализован с использованием **гексагональной архитектуры (Hexagonal / Ports & Adapters)**, что обеспечивает слабую связанность компонентов, тестируемость и расширяемость системы.

Архитектура логически разделена на слои:

* **Domain**
  Формальные модели, политики и интерфейсы принятия решений (MCDM-стратегии, метрики, бизнес-правила).

* **Application**
  Use case-сценарии (выбор узла, обновление метрик, репликация запросов), не зависящие от конкретных технологий.

* **Adapters**
  Входные и выходные адаптеры:

  * HTTP-прокси и middleware;
  * сбор метрик из Docker;
  * хранилища метрик (in-memory);
  * реализации MCDM-алгоритмов и весовых моделей.

Такое разделение позволяет:

* заменять алгоритмы балансировки без изменения прокси-слоя;
* подключать другие источники метрик (Prometheus, Redis и т.д.);
* масштабировать систему без переработки ядра.

---

### Управление зависимостями и сборка

Для управления зависимостями и сборки проекта используется **Poetry**:

* декларативное описание зависимостей в `pyproject.toml`;
* воспроизводимые окружения;
* разделение production и dev-зависимостей;
* поддержка современных стандартов Python-экосистемы.

Проект ориентирован на **Python ≥ 3.12** и использует актуальные версии библиотек.

---

### Асинхронная модель выполнения

FluxBalancer реализован полностью асинхронно:

* FastAPI + asyncio для HTTP-прокси;
* aiohttp для проксирования запросов;
* aioDocker для онлайн-сбора метрик контейнеров;
* фоновые задачи для периодического мониторинга.

Это позволяет минимизировать накладные задержки принятия решений и применять алгоритмы балансировки в реальном времени.

---

### Технологический стек

* **Python 3.12**
* **FastAPI**, **Starlette**
* **aiohttp**, **asyncio**
* **Docker API**, **aiodocker**
* **NumPy** (численные методы, MCDM)
* **Poetry** (dependency management)
* **Hexagonal Architecture (Ports & Adapters)**

